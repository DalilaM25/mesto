(()=>{"use strict";var t=function(t,e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))},e=function(t){return t.target.closest(".card").remove()},n=function(t,e,n,r){t.target.classList.contains("card__like-button_is-active")?function(t,e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n,r._id).then((function(n){t.target.classList.remove("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){console.log(t)})):function(t,e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n,r._id).then((function(n){t.target.classList.add("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){console.log(t)}))};function r(e,n,r,o,c,a,i){var u=e.querySelector(".card").cloneNode(!0),s=u.querySelector(".card__image"),l=u.querySelector(".card__title"),d=u.querySelector(".card__delete-button"),f=u.querySelector(".card__like-button"),p=u.querySelector(".card__like-counter");return s.src=n.link,s.alt=n.name,l.textContent=n.name,p.textContent=n.likes.length,n.likes.forEach((function(t){t._id===r&&f.classList.add("card__like-button_is-active")})),r!==n.owner._id?d.style.display="none":console.log("есть твои карточки"),d.addEventListener("click",(function(e){t(i,n._id).then((function(){return o(e)})).catch((function(t){console.log(t)}))})),f.addEventListener("click",(function(t){return c(t,p,i,n)})),s.addEventListener("click",(function(t){return a(s)})),u}var o=function(t){27===t.keyCode&&u()},c=function(t){t.target.classList.contains("popup__close")&&u()},a=function(t){t.target===t.currentTarget&&u()},i=function(t){t.classList.toggle("popup_is-opened"),document.addEventListener("keydown",o),document.addEventListener("click",c),t.addEventListener("click",a)},u=function(t){(t=document.querySelector(".popup_is-opened")).classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),document.removeEventListener("click",c),t.addEventListener("click",a)},s=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""};function l(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function d(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){s(t,n,e)})),r.classList.add(e.inactiveButtonClass)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var p=document.querySelector("#card-template").content,m=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_avatar"),g=document.forms["edit-avatar"],E=g.elements.link,L=document.forms["edit-profile"],C=L.elements.name,q=L.elements.description,j=document.forms["new-place"],x=j.elements["place-name"],A=j.elements.link,P=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),w=b.querySelector(".popup__image"),T=b.querySelector(".popup__caption"),O=g.querySelector(".popup__button"),B=L.querySelector(".popup__button"),D=j.querySelector(".popup__button"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},M={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"a306f177-c6ab-4a77-8c2f-7f3972575f99","Content-Type":"application/json"}},N="";function J(t,e){e.textContent=t?"Сохранение...":"Сохранить"}function H(t){w.src=t.src,w.alt=t.alt,T.textContent=t.alt,i(b)}_.addEventListener("click",(function(t){C.value=P.textContent,q.value=U.textContent,d(L,I),i(y)})),h.addEventListener("click",(function(t){j.reset(),d(j,I),i(v)})),S.addEventListener("click",(function(t){g.reset(),d(g,I),i(k)})),L.addEventListener("submit",(function(t){t.preventDefault(),J(!0,B),function(t,e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:"".concat(e),about:"".concat(n)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(M,C.value,q.value).then((function(t){P.textContent=t.name,U.textContent=t.about})).then((function(){u(y)})).catch((function(t){return renderError("Ошибка: ".concat(t))})).finally((function(){J(!1,B)}))})),j.addEventListener("submit",(function(t){!function(t){t.preventDefault(),J(!0,D),function(t,e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:"".concat(e),link:"".concat(n),likes:[]})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(M,x.value,A.value).then((function(t){m.prepend(r(p,t,N,e,n,H,M))})).then((function(){return u(v)})).catch((function(t){return renderError("Ошибка: ".concat(t))})).finally((function(){J(!1,D)}))}(t)})),g.addEventListener("submit",(function(t){!function(t){t.preventDefault(),J(!0,O),function(t,e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:"".concat(e)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(M,E.value).then((function(t){S.style.backgroundImage="url(".concat(t.avatar,")")})).then((function(){return u(v)})).catch((function(t){console.log(t)})).finally((function(){return J(!1,O)}))}(t)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);l(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),l(n,r,e)}))}))}(e,t)}))}(I),Promise.all([function(t){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(M),function(t){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(M)]).then((function(t){var o,c,a=(c=2,function(t){if(Array.isArray(t))return t}(o=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(o,c)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(o,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];N=u._id,P.textContent=u.name,U.textContent=u.about,S.style.backgroundImage="url(".concat(u.avatar,")"),function(t){t.forEach((function(t){var o=r(p,t,N,e,n,H,M);m.append(o)}))}(i)})).catch((function(t){console.log(t)}))})();